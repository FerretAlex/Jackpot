<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Jackpot - Matches</title>

    <script>
    tailwind.config={theme:{extend:{colors:{jp:{
      bg:"#F7F7F5",
      text:"#0F172A",
      muted:"#475569",
      card:"#FFFFFF",
      border:"rgba(15, 23, 42, 0.10)",
      gold:"#D4AF37",
      gold2:"#FFD36A",
      ink:"#111827"
    }},boxShadow:{
      soft:"0 12px 30px rgba(15, 23, 42, 0.08)",
      lift:"0 18px 40px rgba(15, 23, 42, 0.12)"
    }}}};
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body{
      background:
        radial-gradient(900px 450px at 80% 0%,rgba(212,175,55,0.14),transparent 60%),
        radial-gradient(700px 380px at 10% 10%,rgba(255,211,106,0.10),transparent 60%),
        radial-gradient(rgba(15,23,42,0.06) 1px,transparent 1px);
      background-size:auto,auto,18px 18px;
      background-position:0 0,0 0,0 0;
    }
  </style>
</head>

<body class="bg-jp-bg text-jp-text min-h-screen flex flex-col antialiased">
  <nav class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-jp-border">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="leading-tight">
          <div class="flex items-center gap-2">
            <span class="text-sm font-semibold tracking-wide">Jackpot</span>
          </div>
          <p class="text-[12px] text-jp-muted">Your chats and last messages</p>
        </div>
      </div>

      <div class="flex items-center gap-4 text-sm">
        <a href="index.html" class="text-jp-muted hover:text-jp-text">Explore</a>
        <a href="profile.html" class="text-jp-muted hover:text-jp-text">Profile</a>
        <button type="button" onclick="logout()" class="text-jp-muted hover:text-red-600">Log-out</button>
      </div>
    </div>
  </nav>

  <main class="flex-1">
    <div class="max-w-5xl mx-auto px-4 py-6">
      <div class="flex items-end justify-between gap-4 mb-6">
        <div>
          <h1 class="text-xl font-semibold">Your chats</h1>
          <p class="text-sm text-jp-muted mt-1">Open a chat to start messaging.</p>
        </div>

        <div class="hidden sm:flex items-center gap-2 px-3 py-2 rounded-xl bg-white border border-jp-border shadow-soft">
          <span class="inline-flex items-center justify-center w-7 h-7 rounded-lg text-jp-ink text-xs font-bold"
            style="background:rgba(212,175,55,0.18);border:1px solid rgba(212,175,55,0.45);">
            ✓
          </span>
          <div class="leading-tight">
            <p class="text-xs font-semibold">Matches</p>
            <p class="text-[11px] text-jp-muted"><span id="count">0</span> total</p>
          </div>
        </div>
      </div>

      <div id="list" class="space-y-3"></div>
      <p id="empty" class="text-sm text-jp-muted mt-4 hidden">You have no matches yet.</p>
    </div>
  </main>

  <footer class="mt-auto border-t border-jp-border bg-white/70 backdrop-blur">
    <div class="max-w-5xl mx-auto px-4 py-4 text-xs text-jp-muted flex items-center justify-between gap-3">
      <p>© <span id="year"></span> Jackpot</p>
      <p class="text-right">December, 2025</p>
    </div>
  </footer>

  <script>
    const token=localStorage.getItem("token");
    const meId=Number(localStorage.getItem("userId"));
    if(!token)window.location.href="login.html";

    const setCount=n=>{
      const c=document.getElementById("count");
      if(c)c.textContent=String(n);
    };

    const escapeHtml=str=>{
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    };

    function openChat(e,id){
      if(e)e.stopPropagation();
      window.location.href=`chat.html?matchId=${id}`;
    }

    function logout(){
      localStorage.clear();
      window.location.href="login.html";
    }

    async function loadMatches(){
      const list=document.getElementById("list");
      const empty=document.getElementById("empty");
      list.innerHTML="";

      const res=await fetch("/api/matches",{headers:{"Authorization":"Bearer "+token}});
      if(res.status===401){
        localStorage.clear();
        window.location.href="login.html";
        return;
      }

      const matches=await res.json();
      setCount(matches.length);

      if(!matches.length){
        empty.classList.remove("hidden");
        return;
      }
      empty.classList.add("hidden");

      matches.forEach(match=>{
        const other=(Number(match.user1)===meId)?match.user2info:match.user1info;
        const lastMsg=match.lastMessage||"";

        const row=document.createElement("div");
        row.className=
          "group p-3 sm:p-4 bg-jp-card border border-jp-border rounded-2xl shadow-soft "+
          "hover:shadow-lift transition-shadow cursor-pointer flex items-center justify-between gap-3";

        row.addEventListener("click",()=>openChat(null,match.id));

        row.innerHTML=`
          <div class="flex items-center gap-3 min-w-0">
            <img
              src="${other?.avatar||"default-avatar.png"}"
              onerror="this.src='default-avatar.png'"
              class="w-12 h-12 rounded-xl object-cover border border-jp-border flex-none"
              alt="avatar"
            />
            <div class="min-w-0">
              <div class="text-sm font-semibold text-jp-text truncate">${other?.name||"No name"}</div>
              <div class="text-xs text-jp-muted truncate max-w-[28rem]">${escapeHtml(lastMsg)}</div>
            </div>
          </div>

          <div class="flex items-center gap-2 flex-none">
            <button type="button"
              class="px-3 py-1.5 rounded-xl text-sm font-semibold text-white bg-[#C9A227]
                     hover:brightness-95 active:translate-y-px transition shadow-soft"
              onclick="openChat(event,${match.id})">
              Open
            </button>
          </div>
        `;

        list.appendChild(row);
      });
    }

    const y=document.getElementById("year");
    if(y)y.textContent=new Date().getFullYear();

    loadMatches();
  </script>
</body>
</html>
